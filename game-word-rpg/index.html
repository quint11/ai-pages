<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡å­—å†’é™© RPG - å®Œæ•´é—­ç¯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: radial-gradient(circle at center, #0f1a3d, #1a2a6c, #0c1026);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1500px;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 30, 0.85);
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.7);
            overflow: hidden;
            border: 2px solid #3a506b;
            position: relative;
        }
        
        /* è£…é¥°æ•ˆæœ */
        .decoration {
            position: absolute;
            opacity: 0.1;
        }
        
        .decoration.sword {
            top: 50px;
            right: 30px;
            font-size: 5rem;
            transform: rotate(30deg);
        }
        
        .decoration.shield {
            bottom: 80px;
            left: 30px;
            font-size: 4rem;
            transform: rotate(-15deg);
        }
        
        header {
            background: linear-gradient(to right, #0c2d6b, #1a3a8f);
            padding: 25px;
            text-align: center;
            border-bottom: 4px solid #d4af37;
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" width="100" height="100"><path d="M0 0 L100 0 L100 100 L0 100 Z" fill="none" stroke="%23d4af37" stroke-width="1" stroke-dasharray="5,5"/></svg>');
            opacity: 0.3;
        }
        
        h1 {
            font-size: 3.2rem;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);
            letter-spacing: 2px;
            position: relative;
            z-index: 2;
            font-weight: 800;
        }
        
        .subtitle {
            color: #a8c6ff;
            font-size: 1.3rem;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
            position: relative;
            z-index: 2;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .screen {
            display: none;
            padding: 25px;
            min-height: 500px;
        }
        
        .screen.active {
            display: block;
        }
        
        .game-container {
            display: flex;
            gap: 25px;
        }
        
        .player-section {
            flex: 1;
            background: rgba(20, 30, 50, 0.7);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            border: 1px solid #3a506b;
            position: relative;
            min-width: 300px;
        }
        
        .game-section {
            flex: 2;
            background: rgba(20, 30, 50, 0.7);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            border: 1px solid #3a506b;
            min-width: 500px;
        }
        
        .section-title {
            font-size: 1.7rem;
            color: #ffd700;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3a506b;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #d4af37;
        }
        
        .status-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            background: linear-gradient(to right, #1c2e4a, #2c3e50);
            padding: 14px;
            border-radius: 10px;
            margin-bottom: 5px;
            border: 1px solid #3a506b;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }
        
        .status-bar:hover {
            transform: translateY(-3px);
        }
        
        .status-label {
            font-weight: bold;
            color: #ffd700;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .progress-bar {
            height: 50px;
            background: rgba(0,0,0,0.3);
            border-radius: 3px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
        }
        
        .health-fill {
            background: linear-gradient(to right, #ff416c, #ff4b2b);
        }
        
        .mana-fill {
            background: linear-gradient(to right, #2193b0, #6dd5ed);
        }
        
        .exp-fill {
            background: linear-gradient(to right, #00b09b, #96c93d);
        }
        
        .inventory {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .item {
            background: linear-gradient(to bottom right, #2c3e50, #1c2e4a);
            padding: 12px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #3a506b;
            box-shadow: 0 3px 6px rgba(0,0,0,0.2);
            transition: transform 0.2s;
            cursor: pointer;
            position: relative;
        }
        
        .item:hover {
            transform: translateY(-3px);
            background: linear-gradient(to bottom right, #3a506b, #2c3e50);
        }
        
        .item-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            color: #ffd700;
        }
        
        .item-count {
            position: absolute;
            top: 5px;
            right: 8px;
            background: #d4af37;
            color: #000;
            font-weight: bold;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .game-log {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 10px;
            padding: 20px;
            height: 320px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            line-height: 1.7;
            margin-bottom: 15px;
            border: 1px solid #3a506b;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="%233a506b" stroke-width="0.5"/></svg>');
        }
        
        .game-log p {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            background: rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .location-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 10px;
        }
        
        .combat-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }
        
        button {
            background: linear-gradient(to bottom, #d4af37, #b8860b);
            color: #1a1a2e;
            border: none;
            padding: 14px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-shadow: 0 1px 0 rgba(255, 255, 255, 0.3);
            font-size: 1.05rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            border: 1px solid #ffd700;
        }
        
        button:hover {
            background: linear-gradient(to bottom, #ffd700, #daa520);
            transform: translateY(-3px);
            box-shadow: 0 7px 14px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background: #444;
            color: #777;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            border: 1px solid #555;
        }
        
        .save-load {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }
        
        .save-load button {
            flex: 1;
        }
        
        .player-info {
            text-align: center;
            position: relative;
            padding: 15px 0;
        }
        
        .player-image {
            font-size: 6rem;
            margin: 10px 0;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
            transition: transform 0.3s;
        }
        
        .player-image:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .player-name {
            font-size: 1.4rem;
            color: #ffd700;
            margin-top: 5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .player-class {
            color: #a8c6ff;
            font-size: 1.1rem;
            margin-top: 3px;
        }
        
        .enemy-info {
            background: linear-gradient(to right, #4b0000, #8b0000);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid #ff5555;
            box-shadow: 0 5px 15px rgba(139, 0, 0, 0.4);
            position: relative;
        }
        
        .enemy-image {
            font-size: 5rem;
            margin-bottom: 15px;
            text-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5));
        }
        
        .enemy-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
        }
        
        .enemy-stat {
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-radius: 10px;
            min-width: 100px;
        }
        
        .event {
            color: #ffcc00;
            border-left: 3px solid #ffcc00;
        }
        
        .damage {
            color: #ff5555;
            background: rgba(139, 0, 0, 0.2);
        }
        
        .heal {
            color: #55ff55;
            background: rgba(0, 100, 0, 0.2);
        }
        
        .gold {
            color: #ffd700;
            background: rgba(184, 134, 11, 0.2);
        }
        
        .quest {
            color: #55ffff;
            border-left: 3px solid #55ffff;
        }
        
        .victory {
            color: #96c93d;
            border-left: 3px solid #96c93d;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            background: linear-gradient(to right, #0c2d6b, #1a3a8f);
            color: #a8c6ff;
            font-size: 1rem;
            border-top: 1px solid #3a506b;
        }
        
        .xp-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .xp-text {
            font-size: 0.9rem;
            color: #aaa;
        }
        
        .level-badge {
            background: #d4af37;
            color: #000;
            font-weight: bold;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.9rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: linear-gradient(to right, #0c2d6b, #1a3a8f);
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transform: translateX(200%);
            transition: transform 0.3s ease;
            z-index: 1000;
            border-left: 5px solid #d4af37;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .start-screen, .end-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            min-height: 500px;
            padding: 40px;
        }
        
        .start-title {
            font-size: 4.0rem;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            margin-bottom: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .start-subtitle {
            font-size: 1.8rem;
            color: #a8c6ff;
            max-width: 1200px;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .start-options {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        
        .start-btn {
            padding: 18px 40px;
            font-size: 1.5rem;
            border-radius: 15px;
        }
        
        .character-select {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin: 40px 0;
        }
        
        .character {
            background: rgba(30, 40, 70, 0.7);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .character:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 25px rgba(0,0,0,0.3);
            border-color: #d4af37;
            background: rgba(40, 50, 90, 0.8);
        }
        
        .character.selected {
            border-color: #ffd700;
            background: rgba(50, 60, 100, 0.9);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.5);
        }
        
        .character-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }
        
        .character-name {
            font-size: 1.8rem;
            color: #ffd700;
            margin-bottom: 10px;
        }
        
        .character-desc {
            font-size: 1.1rem;
            color: #a8c6ff;
            line-height: 1.6;
        }
        
        .victory-screen {
            text-align: center;
        }
        
        .victory-title {
            font-size: 5rem;
            color: #ffd700;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
        }
        
        .victory-image {
            font-size: 10rem;
            margin: 30px 0;
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0px); }
        }
        
        .victory-text {
            font-size: 1.8rem;
            max-width: 800px;
            margin: 0 auto 40px;
            line-height: 1.7;
            color: #a8c6ff;
        }
        
        .end-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 30px 0;
            max-width: 800px;
        }
        
        .end-stat {
            background: rgba(30, 40, 70, 0.7);
            border-radius: 10px;
            padding: 20px;
        }
        
        .end-stat-value {
            font-size: 2.5rem;
            color: #ffd700;
            margin: 10px 0;
        }
        
        .end-stat-label {
            font-size: 1.2rem;
            color: #a8c6ff;
        }
        
        @media (max-width: 900px) {
            .game-container {
                flex-direction: column;
            }
            
            .player-section, .game-section {
                min-width: auto;
            }
            
            .inventory {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .character-select {
                grid-template-columns: 1fr;
            }
            
            .end-stats {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 600px) {
            .action-buttons, .location-buttons, .combat-buttons {
                grid-template-columns: 1fr;
            }
            
            .player-image {
                font-size: 4.5rem;
            }
            
            .enemy-image {
                font-size: 3.5rem;
            }
            
            .enemy-stats {
                flex-direction: column;
                gap: 10px;
            }
            
            .start-options {
                flex-direction: column;
                gap: 15px;
            }
            
            .start-title {
                font-size: 3rem;
            }
            
            .start-subtitle {
                font-size: 1.3rem;
            }
            
            .victory-title {
                font-size: 3rem;
            }
            
            .victory-image {
                font-size: 6rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="decoration sword">âš”ï¸</div>
        <div class="decoration shield">ğŸ›¡ï¸</div>
        
        <header>
            <div class="subtitle">æ¢ç´¢ç¥ç§˜å¤§é™†ï¼Œå‡»è´¥å¼ºå¤§æ•Œäººï¼Œæˆä¸ºä¼ å¥‡è‹±é›„ï¼</div>
        </header>
        
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="startScreen" class="screen active">
            <div class="start-screen">
                <div class="start-title">å†’é™©è€…ä¼ è¯´</div>
                <div class="start-subtitle">åœ¨è¿™ç‰‡è¢«é»‘æš—ç¬¼ç½©çš„å¤§é™†ä¸Šï¼Œä¸€æ¡å¤è€çš„å·¨é¾™è‹é†’äº†ï¼Œå®ƒçš„åŠ›é‡å¨èƒç€æ•´ä¸ªç‹å›½ã€‚ä½œä¸ºè¢«é€‰ä¸­çš„å†’é™©è€…ï¼Œä½ å¿…é¡»è¸ä¸Šå¾é€”ï¼Œæ”¶é›†å¼ºå¤§çš„ç¥å™¨ï¼Œæœ€ç»ˆåœ¨å·¨é¾™å±±è„‰ä¸æ¶é¾™å†³ä¸€æ­»æˆ˜ï¼</div>
                
                <div class="character-select">
                    <div class="character" data-class="warrior">
                        <div class="character-icon">âš”ï¸</div>
                        <div class="character-name">æˆ˜å£«</div>
                        <div class="character-desc">å¼ºå¤§çš„è¿‘æˆ˜ä¸“å®¶ï¼Œæ‹¥æœ‰é«˜ç”Ÿå‘½å€¼å’Œé˜²å¾¡åŠ›<br>ç‰¹æ®Šèƒ½åŠ›ï¼šé›·éœ†ä¸€å‡» - é€ æˆåŒå€ä¼¤å®³</div>
                    </div>
                    
                    <div class="character" data-class="mage">
                        <div class="character-icon">ğŸ§™â€â™‚ï¸</div>
                        <div class="character-name">æ³•å¸ˆ</div>
                        <div class="character-desc">å…ƒç´ é­”æ³•å¤§å¸ˆï¼Œæ‹¥æœ‰å¼ºå¤§çš„æ³•æœ¯æ”»å‡»<br>ç‰¹æ®Šèƒ½åŠ›ï¼šç«ç„°é£æš´ - å¯¹æ•Œäººé€ æˆæŒç»­ä¼¤å®³</div>
                    </div>
                    
                    <div class="character" data-class="ranger">
                        <div class="character-icon">ğŸ¹</div>
                        <div class="character-name">æ¸¸ä¾ </div>
                        <div class="character-desc">æ•æ·çš„è¿œç¨‹ä¸“å®¶ï¼Œæ“…é•¿é—ªé¿å’Œè‡´å‘½ä¸€å‡»<br>ç‰¹æ®Šèƒ½åŠ›ï¼šç²¾å‡†å°„å‡» - å¿…å®šå‘½ä¸­å¹¶é€ æˆé¢å¤–ä¼¤å®³</div>
                    </div>
                </div>
                
                <div class="start-options">
                    <button id="newGameBtn" class="start-btn"><i class="fas fa-play"></i> å¼€å§‹æ–°æ¸¸æˆ</button>
                    <button id="continueBtn" class="start-btn"><i class="fas fa-folder-open"></i> ç»§ç»­æ¸¸æˆ</button>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div id="gameScreen" class="screen">
            <div class="game-container">
                <div class="player-section">
                    <h2 class="section-title"><i class="fas fa-user"></i> å†’é™©è€…ä¿¡æ¯</h2>
                    
                    <div class="player-info">
                        <div class="player-image" id="playerIcon"></div>
                        <div class="player-name" id="playerName"></div>
                        <div class="player-class" id="playerClass"></div>
                    </div>
                    
                    <div class="status-container">
                        <div class="status-bar">
                            <span class="status-label"><i class="fas fa-heart"></i> ç”Ÿå‘½å€¼:</span>
                            <span id="health">100/100</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill health-fill" id="health-bar" style="width: 100%"></div>
                        </div>
                        
                        <div class="status-bar">
                            <span class="status-label"><i class="fas fa-fire"></i> é­”æ³•å€¼:</span>
                            <span id="mana">50/50</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill mana-fill" id="mana-bar" style="width: 100%"></div>
                        </div>
                        <div class="status-bar">
                            <span class="status-label"><i class="fas fa-star"></i> ç»éªŒå€¼:</span>
                            <div class="xp-bar">
                                <span id="exp">0/100</span>
                                <span class="level-badge">Lv.<span id="level">1</span></span>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill exp-fill" id="exp-bar" style="width: 0%"></div>
                        </div>
                        

                        <div class="status-bar">
                            <span class="status-label"><i class="fas fa-shield-alt"></i> æ”»å‡»åŠ›:</span>
                            <span id="attack">15</span>
                        </div>
                       
                        <div class="status-bar">
                            <span class="status-label"><i class="fas fa-shield-virus"></i> é˜²å¾¡åŠ›:</span>
                            <span id="defense">8</span>
                        </div>
                        
                        <div class="status-bar">
                            <span class="status-label"><i class="fas fa-coins"></i> é‡‘å¸:</span>
                            <span id="gold">50</span>
                        </div>
                        
                        
            
                    </div>
                    
                    <h3 class="section-title"><i class="fas fa-backpack"></i> èƒŒåŒ…</h3>
                    <div class="inventory" id="inventory">
                        <div class="item" id="health-potion">
                            <div class="item-icon">â¤ï¸</div>
                            <div>ç”Ÿå‘½è¯æ°´</div>
                            <div class="item-count" id="potion-count">1</div>
                        </div>
                        <div class="item" id="key-item">
                            <div class="item-icon">ğŸ”‘</div>
                            <div>ç¥ç§˜é’¥åŒ™</div>
                            <div class="item-count" id="key-count">0</div>
                        </div>
                        <div class="item" id="gem-item">
                            <div class="item-icon">ğŸ’</div>
                            <div>é¾™ä¹‹å®çŸ³</div>
                            <div class="item-count" id="gem-count">0</div>
                        </div>
                    </div>
                    
                    <div class="save-load">
                        <button id="saveBtn"><i class="fas fa-save"></i> ä¿å­˜è¿›åº¦</button>
                        <button id="menuBtn"><i class="fas fa-home"></i> è¿”å›èœå•</button>
                    </div>
                </div>
                
                <div class="game-section">
                    
                    <div id="combatSection">
                        <div class="enemy-info">
                            <div class="enemy-image" id="enemyImage">ğŸº</div>
                            <div style="font-size: 1.3rem; margin-bottom: 10px;">æ•Œäºº: <span id="enemyName">é‡ç‹¼</span></div>
                            
                            <div class="enemy-stats">
                                <div class="enemy-stat">
                                    <div>ç”Ÿå‘½å€¼</div>
                                    <div id="enemyHealth">40/40</div>
                                    <div class="progress-bar">
                                        <div class="progress-fill health-fill" id="enemy-health-bar" style="width: 100%"></div>
                                    </div>
                                </div>
                                <div class="enemy-stat">
                                    <div>æ”»å‡»åŠ›</div>
                                    <div id="enemyAttack">10</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="combat-buttons">
                            <button id="attackBtn"><i class="fas fa-fist-raised"></i> æ”»å‡»</button>
                            <button id="skillBtn"><i class="fas fa-magic"></i> æŠ€èƒ½</button>
                            <button id="potionBtn"><i class="fas fa-wine-bottle"></i> è¯æ°´</button>
                            <button id="fleeBtn"><i class="fas fa-running"></i> é€ƒè·‘</button>
                        </div>
                    </div>

                    <div id="noCombatSection" style="text-align: center; padding: 40px 20px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">âš”ï¸</div>
                        <p>å½“å‰æ²¡æœ‰æˆ˜æ–—</p>
                        <p class="event" style="margin-top: 10px;">æ¢ç´¢åŒºåŸŸå¯èƒ½ä¼šé‡åˆ°æ•Œäººï¼</p>
                    </div>
                    
                    <h3 class="section-title"><i class="fas fa-map-marker-alt"></i> å½“å‰ä½ç½®: <span id="location">å®é™æ‘åº„</span></h3>
                    
                    <div class="action-buttons">
                        <button id="exploreBtn"><i class="fas fa-binoculars"></i> æ¢ç´¢å½“å‰åŒºåŸŸ</button>
                        <button id="restBtn"><i class="fas fa-bed"></i> ä¼‘æ¯æ¢å¤</button>
                        <button id="shopBtn"><i class="fas fa-shopping-cart"></i> è®¿é—®å•†åº—</button>
                        <button id="upgradeBtn"><i class="fas fa-tools"></i> å‡çº§è£…å¤‡</button>
                    </div>
                    
                    <div class="location-buttons">
                        <button id="forestBtn"><i class="fas fa-tree"></i> å¹½æš—æ£®æ—</button>
                        <button id="caveBtn"><i class="fas fa-mountain"></i> ç¥ç§˜æ´ç©´</button>
                        <button id="mountainBtn"><i class="fas fa-dragon"></i> å·¨é¾™å±±è„‰</button>
                    </div>
                    
                    <h2 class="section-title"><i class="fas fa-scroll"></i> å†’é™©æ—¥å¿—</h2>
                    <div class="game-log" id="gameLog">
                        <p>æ¬¢è¿æ¥åˆ°å†’é™©è€…ä¼ è¯´ï¼ä½ æ˜¯ä¸€ååˆå‡ºèŒ…åºçš„å†’é™©è€…ã€‚</p>
                        <p>ä½ å‡ºç°åœ¨å®é™æ‘åº„çš„å¹¿åœºä¸Šã€‚æ‘æ°‘ä»¬çœ‹èµ·æ¥æœ‰äº›ä¸å®‰ï¼Œä¼¼ä¹æœ‰äº‹æƒ…å‘ç”Ÿã€‚</p>
                        <p class="event">æ‘é•¿å‘Šè¯‰ä½ ï¼šæœ€è¿‘æ‘åº„é™„è¿‘å‡ºç°äº†æ€ªç‰©ï¼Œè¯·å¸®å¸®æˆ‘ä»¬ï¼</p>
                        <p class="quest">ä»»åŠ¡ï¼šå‡»è´¥å¹½æš—æ£®æ—çš„æ€ªç‰©ï¼ˆ0/3ï¼‰</p>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div id="endScreen" class="screen">
            <div class="end-screen">
                <div class="victory-screen">
                    <div class="victory-title">èƒœåˆ©ï¼</div>
                    <div class="victory-image">ğŸ†</div>
                    
                    <div class="victory-text">
                        ç»è¿‡æ¼«é•¿è€Œè‰°è‹¦çš„æˆ˜æ–—ï¼Œä½ ç»ˆäºå‡»è´¥äº†å¯æ€•çš„è¿œå¤çº¢é¾™ï¼å®ƒçš„åŠ›é‡æ¶ˆæ•£åœ¨ç©ºæ°”ä¸­ï¼Œç‹å›½ç»ˆäºä»é˜´å½±ä¸­è§£æ”¾å‡ºæ¥ã€‚äººæ°‘å°†æ°¸è¿œé“­è®°ä½ çš„åå­—ï¼ŒåŸæ¸¸è¯—äººå°†ä¼ å”±ä½ çš„ä¼ å¥‡æ•…äº‹ï¼
                    </div>
                    
                    <div class="end-stats">
                        <div class="end-stat">
                            <div class="end-stat-value" id="finalLevel">1</div>
                            <div class="end-stat-label">æœ€ç»ˆç­‰çº§</div>
                        </div>
                        <div class="end-stat">
                            <div class="end-stat-value" id="finalGold">0</div>
                            <div class="end-stat-label">è·å¾—é‡‘å¸</div>
                        </div>
                        <div class="end-stat">
                            <div class="end-stat-value" id="finalMonsters">0</div>
                            <div class="end-stat-label">å‡»è´¥æ€ªç‰©</div>
                        </div>
                    </div>
                    
                    <button id="restartBtn" class="start-btn"><i class="fas fa-redo"></i> é‡æ–°å¼€å§‹</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>å†’é™©è€…ä¼ è¯´ RPG | å®Œæ•´é—­ç¯æ¸¸æˆ | ä½¿ç”¨HTML5, CSS3å’ŒJavaScriptæ„å»º</p>
        </footer>
    </div>

    <div class="notification" id="notification">é€šçŸ¥æ¶ˆæ¯</div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            characterClass: "warrior",
            health: 100,
            maxHealth: 100,
            mana: 50,
            maxMana: 50,
            attack: 15,
            defense: 8,
            gold: 50,
            exp: 0,
            level: 1,
            potions: 1,
            manaPotions: 0,
            attackPotions: 0,
            defensePotions: 0,
            keys: 0,
            gems: 0,
            location: 'village',
            inCombat: false,
            enemy: null,
            nextLevelExp: 100,
            forestKills: 0,
            caveExplored: false,
            dragonDefeated: false,
            monstersDefeated: 0,
            questStep: 1,
            gameCompleted: false
        };
        
        // æ•Œäººæ•°æ®
        const enemies = {
            forest: [
                { name: "é‡ç‹¼", health: 80, maxHealth: 80, attack: 10, minGold: 5, maxGold: 15, exp: 30, emoji: "ğŸº" },
                { name: "å·¨èœ˜è››", health: 60, maxHealth: 60, attack: 12, minGold: 8, maxGold: 18, exp: 40, emoji: "ğŸ•·ï¸" },
                { name: "æ£®æ—å·¨ç†Š", health: 150, maxHealth: 150, attack: 18, minGold: 20, maxGold: 35, exp: 70, emoji: "ğŸ»" }
            ],
            cave: [
                { name: "æ´ç©´è™è ", health: 65, maxHealth: 65, attack: 8, minGold: 3, maxGold: 10, exp: 20, emoji: "ğŸ¦‡" },
                { name: "å‰§æ¯’èå­", health: 85, maxHealth: 85, attack: 14, minGold: 10, maxGold: 20, exp: 45, emoji: "ğŸ¦‚" },
                { name: "çŸ³åƒé¬¼", health: 180, maxHealth: 180, attack: 22, minGold: 30, maxGold: 50, exp: 100, emoji: "ğŸ—¿" }
            ],
            mountain: [
                { name: "å±±é¹°", health: 125, maxHealth: 125, attack: 16, minGold: 15, maxGold: 25, exp: 50, emoji: "ğŸ¦…" },
                { name: "é›ªæ€ª", health: 200, maxHealth: 200, attack: 26, minGold: 40, maxGold: 70, exp: 150, emoji: "â„ï¸" },
                { name: "çº¢é¾™", health: 500, maxHealth: 500, attack: 45, minGold: 200, maxGold: 300, exp: 500, emoji: "ğŸ‰" }
            ]
        };
        
        // ä½ç½®åç§°æ˜ å°„
        const locationNames = {
            village: "å®é™æ‘åº„",
            forest: "å¹½æš—æ£®æ—",
            cave: "ç¥ç§˜æ´ç©´",
            mountain: "å·¨é¾™å±±è„‰"
        };
        
        // è§’è‰²æ•°æ®
        const classes = {
            warrior: {
                name: "æˆ˜å£«",
                icon: "âš”ï¸",
                attack: 18,
                defense: 12,
                health: 120,
                mana: 30,
                skill: "é›·éœ†ä¸€å‡»"
            },
            mage: {
                name: "æ³•å¸ˆ",
                icon: "ğŸ§™â€â™‚ï¸",
                attack: 22,
                defense: 6,
                health: 90,
                mana: 70,
                skill: "ç«ç„°é£æš´"
            },
            ranger: {
                name: "æ¸¸ä¾ ",
                icon: "ğŸ¹",
                attack: 20,
                defense: 8,
                health: 100,
                mana: 50,
                skill: "ç²¾å‡†å°„å‡»"
            }
        };
        
        // DOM å…ƒç´ 
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const endScreen = document.getElementById('endScreen');
        const gameLog = document.getElementById('gameLog');
        const healthEl = document.getElementById('health');
        const manaEl = document.getElementById('mana');
        const attackEl = document.getElementById('attack');
        const defenseEl = document.getElementById('defense');
        const goldEl = document.getElementById('gold');
        const expEl = document.getElementById('exp');
        const levelEl = document.getElementById('level');
        const potionCountEl = document.getElementById('potion-count');
        const keyCountEl = document.getElementById('key-count');
        const gemCountEl = document.getElementById('gem-count');
        const locationEl = document.getElementById('location');
        const combatSection = document.getElementById('combatSection');
        const enemyNameEl = document.getElementById('enemyName');
        const enemyHealthEl = document.getElementById('enemyHealth');
        const enemyAttackEl = document.getElementById('enemyAttack');
        const enemyImageEl = document.getElementById('enemyImage');
        const healthBar = document.getElementById('health-bar');
        const manaBar = document.getElementById('mana-bar');
        const expBar = document.getElementById('exp-bar');
        const enemyHealthBar = document.getElementById('enemy-health-bar');
        const notification = document.getElementById('notification');
        const playerIcon = document.getElementById('playerIcon');
        const playerName = document.getElementById('playerName');
        const playerClass = document.getElementById('playerClass');
        const finalLevel = document.getElementById('finalLevel');
        const finalGold = document.getElementById('finalGold');
        const finalMonsters = document.getElementById('finalMonsters');
        
        // æ›´æ–°æˆ˜æ–—UI
        function updateCombatUI() {
            if (gameState.inCombat && gameState.enemy) {
                combatSection.style.display = 'block';
                noCombatSection.style.display = 'none';
                updateEnemyInfo();
            } else {
                combatSection.style.display = 'none';
                noCombatSection.style.display = 'block';
            }
        }
        
        // ç¦ç”¨æˆ˜æ–—æŒ‰é’®
        function disableCombatButtons() {
            gameState.actionInProgress = true;
            attackBtn.disabled = true;
            skillBtn.disabled = true;
            potionBtn.disabled = true;
            fleeBtn.disabled = true;
        }
        
        // å¯ç”¨æˆ˜æ–—æŒ‰é’®
        function enableCombatButtons() {
            gameState.actionInProgress = false;
            attackBtn.disabled = false;
            skillBtn.disabled = false;
            potionBtn.disabled = false;
            fleeBtn.disabled = false;
            
            // æ›´æ–°æŠ€èƒ½å†·å´çŠ¶æ€
            updateSkillCooldown();
        }
        
        // æ›´æ–°æŠ€èƒ½å†·å´
        function updateSkillCooldown() {
            if (gameState.skillCooldown > 0) {
                skillBtn.disabled = true;
                const cooldownElement = document.createElement('div');
                cooldownElement.className = 'skill-cooldown';
                cooldownElement.textContent = gameState.skillCooldown;
                
                // ç§»é™¤ç°æœ‰çš„å†·å´æ˜¾ç¤º
                const existingCooldown = document.querySelector('.skill-cooldown');
                if (existingCooldown) existingCooldown.remove();
                
                skillBtn.appendChild(cooldownElement);
            } else {
                skillBtn.disabled = false;
                const existingCooldown = document.querySelector('.skill-cooldown');
                if (existingCooldown) existingCooldown.remove();
            }
        }
        
        // å‡å°‘æŠ€èƒ½å†·å´
        function reduceSkillCooldown() {
            if (gameState.skillCooldown > 0) {
                gameState.skillCooldown--;
                updateSkillCooldown();
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // å¼€å§‹æ–°æ¸¸æˆ
        function startNewGame() {
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            Object.assign(gameState, {
                health: 100,
                maxHealth: 100,
                mana: 50,
                maxMana: 50,
                attack: 15,
                defense: 8,
                gold: 50,
                exp: 0,
                level: 1,
                potions: 1,
                manaPotions: 0,
                attackPotions: 0,
                defensePotions: 0,
                keys: 0,
                gems: 0,
                location: 'village',
                inCombat: false,
                enemy: null,
                nextLevelExp: 100,
                forestKills: 0,
                caveExplored: false,
                dragonDefeated: false,
                monstersDefeated: 0,
                questStep: 1,
                gameCompleted: false
            });
            
            // åº”ç”¨è§’è‰²èŒä¸šåŠ æˆ
            const charClass = classes[gameState.characterClass];
            gameState.maxHealth = charClass.health;
            gameState.health = charClass.health;
            gameState.maxMana = charClass.mana;
            gameState.mana = charClass.mana;
            gameState.attack = charClass.attack;
            gameState.defense = charClass.defense;
            
            // æ›´æ–°è§’è‰²æ˜¾ç¤º
            playerIcon.textContent = charClass.icon;
            playerName.textContent = charClass.name;
            playerClass.textContent = charClass.name;
            
            // æ¸…ç©ºæ—¥å¿—
            gameLog.innerHTML = `
                <p>æ¬¢è¿æ¥åˆ°å†’é™©è€…ä¼ è¯´ï¼ä½ æ˜¯ä¸€å${charClass.name}ã€‚</p>
                <p>ä½ å‡ºç°åœ¨å®é™æ‘åº„çš„å¹¿åœºä¸Šã€‚æ‘æ°‘ä»¬çœ‹èµ·æ¥æœ‰äº›ä¸å®‰ï¼Œä¼¼ä¹æœ‰äº‹æƒ…å‘ç”Ÿã€‚</p>
                <p class="event">æ‘é•¿å‘Šè¯‰ä½ ï¼šæœ€è¿‘æ‘åº„é™„è¿‘å‡ºç°äº†æ€ªç‰©ï¼Œè¯·å¸®å¸®æˆ‘ä»¬ï¼</p>
                <p class="quest">ä»»åŠ¡ï¼šå‡»è´¥å¹½æš—æ£®æ—çš„æ€ªç‰©ï¼ˆ0/3ï¼‰</p>
            `;
            
            // æ›´æ–°UI
            updateStats();
            updateInventory();
            locationEl.textContent = locationNames[gameState.location];
            updateCombatUI();
            
            // åˆ‡æ¢åˆ°æ¸¸æˆç•Œé¢
            startScreen.classList.remove('active');
            gameScreen.classList.add('active');
        }
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStats() {
            healthEl.textContent = `${gameState.health}/${gameState.maxHealth}`;
            manaEl.textContent = `${gameState.mana}/${gameState.maxMana}`;
            attackEl.textContent = gameState.attack;
            defenseEl.textContent = gameState.defense;
            goldEl.textContent = gameState.gold;
            expEl.textContent = `${gameState.exp}/${gameState.nextLevelExp}`;
            levelEl.textContent = gameState.level;
            
            // æ›´æ–°è¿›åº¦æ¡
            const healthPercent = (gameState.health / gameState.maxHealth) * 100;
            healthBar.style.width = `${healthPercent}%`;
            
            const manaPercent = (gameState.mana / gameState.maxMana) * 100;
            manaBar.style.width = `${manaPercent}%`;
            
            const expPercent = (gameState.exp / gameState.nextLevelExp) * 100;
            expBar.style.width = `${expPercent}%`;
        }
        
        // æ›´æ–°èƒŒåŒ…
        function updateInventory() {
            potionCountEl.textContent = gameState.potions;
            keyCountEl.textContent = gameState.keys;
            gemCountEl.textContent = gameState.gems;
        }
        
        // æ·»åŠ æ—¥å¿—
        function addToLog(message, className = "") {
            const p = document.createElement('p');
            if (className) p.className = className;
            p.textContent = message;
            gameLog.appendChild(p);
            gameLog.scrollTop = gameLog.scrollHeight;
        }
        
        // æ¢ç´¢å½“å‰åŒºåŸŸ
        function explore() {
            if (gameState.inCombat) {
                addToLog("ä½ æ­£åœ¨æˆ˜æ–—ä¸­ï¼Œæ— æ³•æ¢ç´¢ï¼", "event");
                return;
            }
            
            // 30%çš„å‡ ç‡æ²¡æœ‰é‡åˆ°æ•Œäºº
            if (Math.random() < 0.3) {
                // éšæœºäº‹ä»¶
                const events = [
                    "ä½ åœ¨è¯¥åŒºåŸŸæ¢ç´¢äº†ä¸€ç•ªï¼Œå‘ç°äº†ä¸€äº›æœ‰ç”¨çš„è‰è¯ã€‚",
                    "ä½ å‘ç°äº†ä¸€ä¸ªå®ç®±ï¼Œé‡Œé¢æœ‰ä¸€äº›é‡‘å¸ï¼",
                    "ä½ é‡åˆ°äº†ä¸€ä½æ—…è¡Œå•†äººï¼Œä»–å–ç»™ä½ ä¸€äº›è¯æ°´ã€‚",
                    "ä½ å‘ç°äº†ä¸€ä¸ªåºŸå¼ƒçš„è¥åœ°ï¼Œæ‰¾åˆ°äº†ä¸€äº›è¡¥ç»™ã€‚",
                    "ä½ å‘ç°äº†ä¸€ä¸ªéšè—çš„æ´ç©´å…¥å£ã€‚"
                ];
                
                const event = events[Math.floor(Math.random() * events.length)];
                addToLog(event, "event");
                
                // å¥–åŠ±
                if (Math.random() < 0.4) {
                    const goldGain = Math.floor(Math.random() * 10) + 5;
                    gameState.gold += goldGain;
                    addToLog(`è·å¾—äº†${goldGain}é‡‘å¸ï¼`, "gold");
                    showNotification(`è·å¾— ${goldGain} é‡‘å¸ï¼`);
                }
                
                if (Math.random() < 0.3) {
                    gameState.potions++;
                    addToLog("è·å¾—äº†1ç“¶ç”Ÿå‘½è¯æ°´ï¼", "heal");
                    showNotification("è·å¾—ç”Ÿå‘½è¯æ°´ x1");
                    updateInventory();
                }
                
                // æ´ç©´æ¢ç´¢ç‰¹æ®Šäº‹ä»¶
                if (gameState.location === 'cave' && !gameState.caveExplored && Math.random() < 0.5) {
                    gameState.keys++;
                    addToLog("åœ¨æ´ç©´æ·±å¤„ï¼Œä½ æ‰¾åˆ°äº†ç¥ç§˜é’¥åŒ™ï¼", "event");
                    showNotification("è·å¾—ç¥ç§˜é’¥åŒ™ x1");
                    gameState.caveExplored = true;
                    updateInventory();
                    
                    // æ›´æ–°ä»»åŠ¡
                    addToLog("ä»»åŠ¡ï¼šå‰å¾€å·¨é¾™å±±è„‰å‡»è´¥çº¢é¾™", "quest");
                    gameState.questStep = 3;
                }
                
                updateStats();
                return;
            }
            
            // é‡åˆ°æ•Œäºº
            const enemyList = enemies[gameState.location];
            const enemy = {...enemyList[Math.floor(Math.random() * enemyList.length)]};
            
      
            gameState.enemy = enemy;
            
            gameState.inCombat = true;
            
            // æ˜¾ç¤ºæˆ˜æ–—ç•Œé¢
            updateCombatUI();
            updateEnemyInfo();
            
            addToLog(`ä½ åœ¨${locationNames[gameState.location]}é‡åˆ°äº†ä¸€åª${gameState.enemy.name}ï¼`, "event");
            addToLog(`æˆ˜æ–—å¼€å§‹ï¼${gameState.enemy.name}å‘ä½ æ‰‘æ¥ï¼`);
        }
        
        // æ›´æ–°æ•Œäººä¿¡æ¯
        function updateEnemyInfo() {
            if (!gameState.enemy) return;
            
            enemyNameEl.textContent = gameState.enemy.name;
            enemyHealthEl.textContent = `${gameState.enemy.health}/${gameState.enemy.maxHealth}`;
            enemyAttackEl.textContent = gameState.enemy.attack;
            enemyImageEl.textContent = gameState.enemy.emoji;
            
            // æ›´æ–°æ•Œäººè¡€æ¡
            const healthPercent = (gameState.enemy.health / gameState.enemy.maxHealth) * 100;
            enemyHealthBar.style.width = `${healthPercent}%`;
        }
        
        // ç©å®¶æ”»å‡»
        function playerAttack() {
            if (!gameState.inCombat || !gameState.enemy) return;
            
            disableCombatButtons()
            // è®¡ç®—ä¼¤å®³ï¼ˆæœ‰10%å‡ ç‡æš´å‡»ï¼‰
            const isCritical = Math.random() < 0.1;
            let damage = gameState.attack + Math.floor(Math.random() * 6);
            
            if (isCritical) {
                damage = Math.floor(damage * 1.8);
                addToLog("æš´å‡»ï¼", "damage");
            }
            
            gameState.enemy.health -= damage;
            
            addToLog(`ä½ å¯¹${gameState.enemy.name}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, "damage");
            updateEnemyInfo();
            
            if (gameState.enemy.health <= 0) {
                enemyDefeated();
                return;
            }
            
            // æ•Œäººåå‡»
            setTimeout(enemyAttack, 800);
        }
        
        // æ•Œäººæ”»å‡»
        function enemyAttack() {
            if (!gameState.inCombat || !gameState.enemy) return;
            
            // è®¡ç®—ä¼¤å®³ï¼ˆç©å®¶æœ‰15%å‡ ç‡é—ªé¿ï¼‰
            const isDodged = Math.random() < 0.15;
            if (isDodged) {
                addToLog(`ä½ é—ªé¿äº†${gameState.enemy.name}çš„æ”»å‡»ï¼`, "event");
                enableCombatButtons()
                return;
            }
            
            let damage = Math.max(1, gameState.enemy.attack + Math.floor(Math.random() * 4) - Math.floor(gameState.defense / 3));
            gameState.health -= damage;
            
            addToLog(`${gameState.enemy.name}å¯¹ä½ é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, "damage");
            updateStats();
            enableCombatButtons()
            if (gameState.health <= 0) {
                gameOver();
                return;
            }
        }
        
        // æ•Œäººè¢«å‡»è´¥
        function enemyDefeated() {
            gameState.monstersDefeated++;
            addToLog(`ä½ å‡»è´¥äº†${gameState.enemy.name}ï¼`, "event");
            enableCombatButtons();
            // è·å–å¥–åŠ±
            const goldGain = Math.floor(Math.random() * (gameState.enemy.maxGold - gameState.enemy.minGold + 1)) + gameState.enemy.minGold;
            gameState.gold += goldGain;
            gameState.exp += gameState.enemy.exp;
            
            addToLog(`è·å¾—äº†${goldGain}é‡‘å¸å’Œ${gameState.enemy.exp}ç»éªŒå€¼ï¼`, "gold");
            showNotification(`è·å¾— ${goldGain} é‡‘å¸å’Œ ${gameState.enemy.exp} ç»éªŒå€¼ï¼`);
            
            // ç‰¹æ®Šæ‰è½
            if (Math.random() < 0.15) {
                gameState.potions++;
                addToLog("è·å¾—äº†1ç“¶ç”Ÿå‘½è¯æ°´ï¼", "heal");
                showNotification("è·å¾—ç”Ÿå‘½è¯æ°´ x1");
            }
            
            
            // ä»»åŠ¡ç³»ç»Ÿ
            if (gameState.location === 'forest' && gameState.questStep === 1) {
                gameState.forestKills++;
                if (gameState.forestKills >= 3) {
                    gameState.questStep = 2;
                    addToLog("ä»»åŠ¡å®Œæˆï¼šå‡»è´¥å¹½æš—æ£®æ—çš„æ€ªç‰©ï¼", "quest");
                    addToLog("ä»»åŠ¡ï¼šæ¢ç´¢ç¥ç§˜æ´ç©´å¹¶æ‰¾åˆ°é’¥åŒ™", "quest");
                }
            }
            
            // å‡»è´¥çº¢é¾™
            if (gameState.enemy.name === "çº¢é¾™") {
                gameState.dragonDefeated = true;
                gameState.gameCompleted = true;
                addToLog("ä½ å‡»è´¥äº†è¿œå¤çº¢é¾™ï¼Œæ‹¯æ•‘äº†ç‹å›½ï¼", "victory");
                showNotification("æ­å–œï¼ä½ å‡»è´¥äº†çº¢é¾™ï¼");
                
                // æ˜¾ç¤ºèƒœåˆ©ç•Œé¢
                finalLevel.textContent = gameState.level;
                finalGold.textContent = gameState.gold;
                finalMonsters.textContent = gameState.monstersDefeated;
                
                setTimeout(() => {
                    gameScreen.classList.remove('active');
                    endScreen.classList.add('active');
                }, 3000);
            }
            
            // æ£€æŸ¥å‡çº§
            checkLevelUp();
            updateInventory();
            
            // ç»“æŸæˆ˜æ–—
            gameState.inCombat = false;
            gameState.enemy = null;
            updateCombatUI();
            
            updateStats();
        }
        
        // æ£€æŸ¥å‡çº§
        function checkLevelUp() {
            if (gameState.exp >= gameState.nextLevelExp) {
                gameState.level++;
                gameState.exp -= gameState.nextLevelExp;
                gameState.nextLevelExp = Math.floor(gameState.nextLevelExp * 1.6);
                
                gameState.maxHealth += 25;
                gameState.health = gameState.maxHealth;
                gameState.maxMana += 15;
                gameState.mana = gameState.maxMana;
                gameState.attack += 6;
                gameState.defense += 3;
                
                addToLog(`æ­å–œï¼ä½ å‡åˆ°äº†${gameState.level}çº§ï¼ç”Ÿå‘½å€¼+25ï¼Œé­”æ³•å€¼+15ï¼Œæ”»å‡»åŠ›+6ï¼Œé˜²å¾¡åŠ›+3`, "event");
                showNotification(`å‡çº§åˆ° ${gameState.level} çº§ï¼`);
            }
        }
        
        // ä½¿ç”¨è¯æ°´
        function usePotion() {
            if (gameState.potions > 0) {
                gameState.potions--;
                const healAmount = Math.floor(gameState.maxHealth * 0.6);
                gameState.health = Math.min(gameState.maxHealth, gameState.health + healAmount);
                
                addToLog(`ä½ ä½¿ç”¨äº†ä¸€ç“¶ç”Ÿå‘½è¯æ°´ï¼Œæ¢å¤äº†${healAmount}ç‚¹ç”Ÿå‘½å€¼ã€‚`, "heal");
                updateStats();
                updateInventory();
                // æ•Œäººåå‡»
                setTimeout(enemyAttack, 800);
            } else {
                addToLog("ä½ æ²¡æœ‰ç”Ÿå‘½è¯æ°´äº†ï¼", "event");
            }
        }
        
        // ä½¿ç”¨æŠ€èƒ½
        function useSkill() {
            const charClass = classes[gameState.characterClass];
            
            if (gameState.mana < 20) {
                addToLog("é­”æ³•å€¼ä¸è¶³ï¼Œæ— æ³•ä½¿ç”¨æŠ€èƒ½ï¼", "event");
                return;
            }
            
            gameState.mana -= 20;
            disableCombatButtons()

            let damage = 0;
            switch(gameState.characterClass) {
                case 'warrior':
                    damage = Math.floor(gameState.attack * 1.8);
                    addToLog(`ä½ ä½¿ç”¨äº†${charClass.skill}ï¼Œå¯¹${gameState.enemy.name}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, "damage");
                    break;
                case 'mage':
                    damage = Math.floor(gameState.attack * 1.5);
                    // ç«ç„°é£æš´æœ‰2å›åˆæŒç»­ä¼¤å®³
                    addToLog(`ä½ ä½¿ç”¨äº†${charClass.skill}ï¼Œå¯¹${gameState.enemy.name}é€ æˆäº†${damage}ç‚¹ä¼¤å®³å¹¶ä½¿å…¶ç‡ƒçƒ§ï¼`, "damage");
                    // ä¸‹ä¸€å›åˆé¢å¤–ä¼¤å®³
                    setTimeout(() => {
                        if (gameState.inCombat && gameState.enemy) {
                            const extraDamage = Math.floor(damage * 0.4);
                            gameState.enemy.health -= extraDamage;
                            addToLog(`${gameState.enemy.name}å—åˆ°${extraDamage}ç‚¹ç‡ƒçƒ§ä¼¤å®³ï¼`, "damage");
                            updateEnemyInfo();
                            
                            if (gameState.enemy.health <= 0) {
                                enemyDefeated();
                                return;
                            }
                        }
                    }, 1000);
                    break;
                case 'ranger':
                    damage = gameState.attack + 15; // å¿…å®šå‘½ä¸­å¹¶é¢å¤–ä¼¤å®³
                    addToLog(`ä½ ä½¿ç”¨äº†${charClass.skill}ï¼Œå¯¹${gameState.enemy.name}é€ æˆäº†${damage}ç‚¹ä¼¤å®³ï¼`, "damage");
                    break;
            }
            
            gameState.enemy.health -= damage;
            updateEnemyInfo();
            
            if (gameState.enemy.health <= 0) {
                enemyDefeated();
                return;
            }
            
            updateStats();
            setTimeout(enemyAttack, 1000);
        }
        
        // é€ƒè·‘
        function flee() {
            if (!gameState.inCombat) return;

            disableCombatButtons()
            // 70%çš„å‡ ç‡é€ƒè·‘æˆåŠŸ
            if (Math.random() < 0.7) {
                addToLog("ä½ æˆåŠŸé€ƒç¦»äº†æˆ˜æ–—ï¼", "event");
                gameState.inCombat = false;
                gameState.enemy = null;
                updateCombatUI();
                enableCombatButtons();
            } else {
                addToLog("é€ƒè·‘å¤±è´¥ï¼", "event");
                setTimeout(enemyAttack, 800);
            }
        }
        
        // ä¼‘æ¯æ¢å¤
        function rest() {
            if (gameState.inCombat) {
                addToLog("ä½ æ­£åœ¨æˆ˜æ–—ä¸­ï¼Œæ— æ³•ä¼‘æ¯ï¼", "event");
                return;
            }
            
            gameState.health = gameState.maxHealth;
            gameState.mana = gameState.maxMana;
            addToLog("ä½ ä¼‘æ¯äº†ä¸€ä¼šå„¿ï¼Œç”Ÿå‘½å€¼å’Œé­”æ³•å€¼å®Œå…¨æ¢å¤äº†ã€‚", "heal");
            updateStats();
        }
        
        // è®¿é—®å•†åº—
        function visitShop() {
            if (gameState.inCombat) {
                addToLog("ä½ æ­£åœ¨æˆ˜æ–—ä¸­ï¼Œæ— æ³•è®¿é—®å•†åº—ï¼", "event");
                return;
            }
            
            if (gameState.gold >= 30) {
                gameState.gold -= 30;
                gameState.potions++;
                addToLog("ä½ èŠ±è´¹30é‡‘å¸è´­ä¹°äº†ä¸€ç“¶ç”Ÿå‘½è¯æ°´ã€‚", "gold");
                updateStats();
                updateInventory();
                showNotification("è´­ä¹°ç”Ÿå‘½è¯æ°´ x1");
            } else {
                addToLog("é‡‘å¸ä¸è¶³ï¼Œæ— æ³•è´­ä¹°ç”Ÿå‘½è¯æ°´ï¼", "event");
            }
        }
        
        // å‡çº§è£…å¤‡
        function upgradeEquipment() {
            if (gameState.inCombat) {
                addToLog("ä½ æ­£åœ¨æˆ˜æ–—ä¸­ï¼Œæ— æ³•å‡çº§è£…å¤‡ï¼", "event");
                return;
            }
            
            if (gameState.gold >= 100) {
                gameState.gold -= 100;
                gameState.attack += 5;
                addToLog("ä½ èŠ±è´¹100é‡‘å¸å‡çº§äº†æ­¦å™¨ï¼Œæ”»å‡»åŠ›+5ï¼", "gold");
                updateStats();
                showNotification("æ”»å‡»åŠ› +5");
            } else {
                addToLog("å‡çº§æ­¦å™¨éœ€è¦100é‡‘å¸ï¼", "event");
            }
        }
        
        // ç§»åŠ¨åˆ°æ–°åŒºåŸŸ
        function moveTo(location) {
            if (gameState.inCombat) {
                addToLog("ä½ æ­£åœ¨æˆ˜æ–—ä¸­ï¼Œæ— æ³•ç§»åŠ¨ï¼", "event");
                return;
            }
            
            // å·¨é¾™å±±è„‰éœ€è¦é’¥åŒ™
            if (location === 'mountain' && gameState.keys < 1) {
                addToLog("ä½ éœ€è¦ç¥ç§˜é’¥åŒ™æ‰èƒ½è¿›å…¥å·¨é¾™å±±è„‰ï¼", "event");
                return;
            }
            
            // æ´ç©´éœ€è¦å®Œæˆæ£®æ—ä»»åŠ¡
            if (location === 'cave' && gameState.questStep < 2) {
                addToLog("ä½ éœ€è¦å…ˆå®Œæˆæ£®æ—ä»»åŠ¡æ‰èƒ½è¿›å…¥æ´ç©´ï¼", "event");
                return;
            }
            
            gameState.location = location;
            locationEl.textContent = locationNames[location];
            addToLog(`ä½ æ¥åˆ°äº†${locationNames[location]}ã€‚`, "event");
            
            // ç‰¹æ®ŠåŒºåŸŸäº‹ä»¶
            if (location === 'cave') {
                addToLog("æ´ç©´ä¸­å¼¥æ¼«ç€ç¥ç§˜çš„æ°”æ¯ï¼Œæ·±å¤„ä¼¼ä¹éšè—ç€å®è—...", "event");
                if (gameState.questStep === 2) {
                    addToLog("ä»»åŠ¡ï¼šåœ¨æ´ç©´æ·±å¤„æ‰¾åˆ°ç¥ç§˜é’¥åŒ™", "quest");
                }
            } else if (location === 'mountain') {
                addToLog("å·¨é¾™å±±è„‰å¯’é£å‡›å†½ï¼Œè¿œå¤„ä¼ æ¥å·¨é¾™çš„å’†å“®å£°...", "event");
                if (gameState.questStep === 3) {
                    addToLog("ä»»åŠ¡ï¼šå‡»è´¥è¿œå¤çº¢é¾™", "quest");
                }
            }
        }
        
        // æ¸¸æˆç»“æŸ
        function gameOver() {
            addToLog("ä½ è¢«å‡»è´¥äº†...æ¸¸æˆç»“æŸï¼", "event");
            addToLog("æŒ‰F5åˆ·æ–°é¡µé¢é‡æ–°å¼€å§‹æ¸¸æˆã€‚");
            gameState.inCombat = false;
            updateCombatUI();
            enableCombatButtons();
        }
        
        // ä¿å­˜æ¸¸æˆ
        function saveGame() {
            localStorage.setItem('textRPG_save', JSON.stringify(gameState));
            addToLog("æ¸¸æˆè¿›åº¦å·²ä¿å­˜ï¼", "event");
            showNotification("æ¸¸æˆè¿›åº¦å·²ä¿å­˜");
        }
        
        // åŠ è½½æ¸¸æˆ
        function loadGame() {
            const saveData = localStorage.getItem('textRPG_save');
            if (saveData) {
                try {
                    const savedState = JSON.parse(saveData);
                    Object.assign(gameState, savedState);
                    
                    // æ›´æ–°è§’è‰²æ˜¾ç¤º
                    const charClass = classes[gameState.characterClass];
                    playerIcon.textContent = charClass.icon;
                    playerName.textContent = charClass.name;
                    playerClass.textContent = charClass.name;
                    
                    updateStats();
                    locationEl.textContent = locationNames[gameState.location];
                    updateInventory();
                    
                    // åˆ‡æ¢åˆ°æ¸¸æˆç•Œé¢
                    startScreen.classList.remove('active');
                    gameScreen.classList.add('active');
                    
                    addToLog("æ¸¸æˆè¿›åº¦å·²åŠ è½½ï¼", "event");
                    showNotification("æ¸¸æˆè¿›åº¦å·²åŠ è½½");
                } catch (e) {
                    alert("åŠ è½½å­˜æ¡£å¤±è´¥ï¼");
                }
            } else {
                alert("æ²¡æœ‰æ‰¾åˆ°å­˜æ¡£ï¼");
            }
        }
        
        // äº‹ä»¶ç›‘å¬
        document.getElementById('exploreBtn').addEventListener('click', explore);
        document.getElementById('restBtn').addEventListener('click', rest);
        document.getElementById('shopBtn').addEventListener('click', visitShop);
        document.getElementById('upgradeBtn').addEventListener('click', upgradeEquipment);
        document.getElementById('forestBtn').addEventListener('click', () => moveTo('forest'));
        document.getElementById('caveBtn').addEventListener('click', () => moveTo('cave'));
        document.getElementById('mountainBtn').addEventListener('click', () => moveTo('mountain'));
        document.getElementById('attackBtn').addEventListener('click', playerAttack);
        document.getElementById('skillBtn').addEventListener('click', useSkill);
        document.getElementById('potionBtn').addEventListener('click', usePotion);
        document.getElementById('fleeBtn').addEventListener('click', flee);
        document.getElementById('saveBtn').addEventListener('click', saveGame);
        document.getElementById('menuBtn').addEventListener('click', () => {
            gameScreen.classList.remove('active');
            startScreen.classList.add('active');
        });
        document.getElementById('restartBtn').addEventListener('click', () => {
            endScreen.classList.remove('active');
            startScreen.classList.add('active');
        });
        
        // è§’è‰²é€‰æ‹©
        const characters = document.querySelectorAll('.character');
        characters.forEach(character => {
            character.addEventListener('click', () => {
                // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
                characters.forEach(c => c.classList.remove('selected'));
                
                // è®¾ç½®å½“å‰é€‰æ‹©
                character.classList.add('selected');
                gameState.characterClass = character.dataset.class;
            });
        });
        
        // æ–°æ¸¸æˆæŒ‰é’®
        document.getElementById('newGameBtn').addEventListener('click', startNewGame);
        
        // ç»§ç»­æ¸¸æˆæŒ‰é’®
        document.getElementById('continueBtn').addEventListener('click', loadGame);
        
        // é»˜è®¤é€‰æ‹©æˆ˜å£«
        document.querySelector('.character[data-class="warrior"]').classList.add('selected');
    </script>
</body>
</html>
